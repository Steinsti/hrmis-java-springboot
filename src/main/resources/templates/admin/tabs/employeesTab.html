<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
    <head>
        <meta charset="UTF-8">
        <title>STEIN HRIMS</title>
        <link rel="stylesheet" th:href="@{/css/styles.build.tailwind.css}">
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
            rel="stylesheet">
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <style>
        /* Custom scrollbar and font styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Tailwind's bg-gray-100 is #f3f4f6, slightly different */
            color: #334155; /* Tailwind's text-gray-700 is #374151, text-gray-800 is #1f2937 */
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0; /* Tailwind's bg-gray-200 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8; /* Tailwind's bg-gray-400 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* Tailwind's bg-gray-600 */
        }
        #sidebar.sidebar-closed {
            transform: translateX(-100%);
        }
        #sidebar.sidebar-open {
            transform: translateX(0);
        }
        @media (min-width: 768px) {
            #sidebar {
                transform: translateX(0);
                position: relative;
            }
        }
    </style>
        <title>Insert title here</title>
        <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    </head>
    <body>
        <div class="min-h-screen flex">
            <div id="sidebar"
                th:replace="~{fragments/sidebar :: sidebar(${userRole}, ${userName})}"
                class="fixed inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0
                 transition-transform duration-300 ease-in-out
                 bg-slate-800 text-white w-64 space-y-6 py-7 px-2 z-30">
            </div>
            <div id="content"
                class="flex-1 flex flex-col overflow-y-auto md:ml-2">
                <div th:replace="~{fragments/topbar}"></div>
                <div id="main-content">
                    <main class="flex-1 p-6 md:p-8 lg:p-10">
                        <div th:replace="~{employees/base}"></div>
                    </main>
                </div>

                <div id="footer"
                    th:replace="~{fragments/footer :: footer}"></div>

                <div id="modal-container"></div>
            </div>

        </div>
        <script th:inline="javascript">
            // JavaScript for sidebar toggle on mobile
            const sidebar = document.getElementById('sidebar');
            const openSidebarButton = document.getElementById('openSidebarButton');
            const closeSidebarButton = document.getElementById('closeSidebarButton'); // This button needs to exist in your sidebar fragment

            function openNav() {
                // Add 'sidebar-open' to trigger the mobile sidebar visibility
                sidebar.classList.add('sidebar-open');
                sidebar.classList.remove('sidebar-closed'); // Ensure 'sidebar-closed' is removed
            }

            function closeNav() {
                // Add 'sidebar-closed' to hide the mobile sidebar
                sidebar.classList.add('sidebar-closed');
                sidebar.classList.remove('sidebar-open'); // Ensure 'sidebar-open' is removed
            }

            if (openSidebarButton) {
                openSidebarButton.addEventListener('click', openNav);
            }
            // Ensure closeSidebarButton exists in your sidebar fragment, e.g.:
            // <button id="closeSidebarButton" class="absolute top-0 right-0 p-4 md:hidden">X</button>
            if (closeSidebarButton) {
                closeSidebarButton.addEventListener('click', closeNav);
            }

    // Optional: Close sidebar if clicking outside of it on mobile
        document.addEventListener('click', function(event) {
            const isClickInsideSidebar = sidebar.contains(event.target);
            const isClickOnOpenButton = openSidebarButton ? openSidebarButton.contains(event.target) : false;

            // Only close if on mobile, sidebar is open, and click is outside sidebar and not on the open button
            if (!isClickInsideSidebar && !isClickOnOpenButton && sidebar.classList.contains('sidebar-open') && window.innerWidth < 768) {
                closeNav();
            }
        });

    // Initial state on page load for mobile: ensure sidebar is closed
        window.addEventListener('DOMContentLoaded', (event) => {
            if (window.innerWidth < 768) {
                closeNav();
                // sidebar.classList.add('sidebar-closed');
            } else {
                openNav();
                // sidebar.classList.remove('sidebar-closed'); // On desktop, it should be open
            }
        });

    // Handle resizing (e.g., rotating phone, resizing browser window)
        window.addEventListener('resize', () => {
            if (window.innerWidth < 768) {
                console.log("resize event")
                // If resized to mobile size, ensure it's closed by default
                if (sidebar.classList.contains('sidebar-open')) {
                    closeNav();
                }
            } else {
                // If resized to desktop size, ensure it's open and relative
                sidebar.classList.remove('sidebar-closed');
                sidebar.classList.remove('sidebar-open'); // Remove mobile-specific classes
            }
        });

     // Function to highlight the active navigation link
            function highlightNavLink(clickedElement) {
                // Remove 'active-link' class from all links
                document.querySelectorAll('#sidebar nav a').forEach(link => {
                    link.classList.remove('bg-slate-700', 'text-slate-100');
                    link.classList.add('text-slate-300', 'hover:bg-slate-700', 'hover:text-slate-100'); // Re-add default styling
                });

                // Add 'active-link' class to the clicked link
                clickedElement.classList.add('bg-slate-700', 'text-slate-100');
                clickedElement.classList.remove('text-slate-300', 'hover:bg-slate-700', 'hover:text-slate-100'); // Remove default styling
            }

        // Initial highlighting based on current URL on page load
            document.addEventListener('DOMContentLoaded', () => {
                const currentPath = window.location.pathname;
                document.querySelectorAll('#sidebar nav a').forEach(link => {
                    const linkHref = link.getAttribute('th:href') || link.getAttribute('href');
                    if (linkHref && currentPath.startsWith(linkHref)) {
                        highlightNavLink(link);
                    }
                });
            });

        // Listen for HTMX swaps to re-evaluate active link if the URL changes
            document.body.addEventListener('htmx:afterSwap', (event) => {
                const currentPath = window.location.pathname;
                document.querySelectorAll('#sidebar nav a').forEach(link => {
                    const linkHref = link.getAttribute('th:href') || link.getAttribute('href');
                    // Use startsWith for '/employees' to match '/employees'
                    // and also for '/admin/dashboard'
                    if (linkHref && currentPath.startsWith(linkHref)) {
                        highlightNavLink(link);
                    }
                });
            })


        </script>

    </body>
</html>
