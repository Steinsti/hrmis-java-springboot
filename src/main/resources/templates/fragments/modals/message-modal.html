<div th:fragment="messageModal" id="messageModalOverlay"
    class="fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 transition-opacity duration-300 opacity-0 hidden"
    role="alertdialog" aria-labelledby="messageModalTitle">
    <div id="messageModalContent"
        class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4 text-center transition-all duration-300 ease-out transform scale-95 opacity-0">
        <h3 id="messageModalTitle"
            th:text="${type == 'success' ? 'Success!' : 'Error!'}"
            th:classappend="${type == 'success' ? 'text-green-600' : 'text-red-600'}"
            class="text-2xl font-bold mb-4"></h3>
        <p id="messageModalText" th:text="${message}"
            class="text-gray-700 mb-6"></p>
        <button id="closeMessageModalBtn"
            class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition duration-300">
            OK
        </button>
    </div>

    <script>
        // Wrap the script in an IIFE to create a new scope and prevent variable conflicts
        (function() {
            // Get references to elements for this specific message modal
            const messageModalOverlay = document.getElementById('messageModalOverlay');
            const messageModalContent = document.getElementById('messageModalContent');
            const closeMessageModalBtn = document.getElementById('closeMessageModalBtn');

            // Function to show the message modal
            function showMessageModal() {
                if (!messageModalOverlay || !messageModalContent) return;

                messageModalOverlay.classList.remove('hidden');
                setTimeout(() => {
                    messageModalOverlay.classList.remove('opacity-0');
                    messageModalContent.classList.remove('scale-95', 'opacity-0');
                    messageModalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            }

            // Function to hide the message modal
            function hideMessageModal() {
                if (!messageModalOverlay || !messageModalContent) return;

                messageModalOverlay.classList.add('opacity-0');
                messageModalContent.classList.remove('scale-100', 'opacity-100');
                messageModalContent.classList.add('scale-95', 'opacity-0');

                messageModalOverlay.addEventListener('transitionend', function handler() {
                    messageModalOverlay.classList.add('hidden');
                    messageModalOverlay.removeEventListener('transitionend', handler);
                    messageModalOverlay.remove(); // Remove from DOM after transition
                });
            }

            // Initialize display and attach listeners
            document.addEventListener('DOMContentLoaded', showMessageModal);

            if (closeMessageModalBtn) {
                closeMessageModalBtn.addEventListener('click', hideMessageModal);
            }

            // Close on overlay click
            if (messageModalOverlay) {
                messageModalOverlay.addEventListener('click', (e) => {
                    if (e.target === messageModalOverlay) {
                        hideMessageModal();
                    }
                });
            }

            // Close on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && messageModalOverlay && !messageModalOverlay.classList.contains('hidden')) {
                    hideMessageModal();
                }
            });
        })(); // Immediately invoke the function
    </script>
</div>
